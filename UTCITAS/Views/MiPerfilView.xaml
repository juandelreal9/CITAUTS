<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="UTCITAS.Views.MiPerfilView"
             Title="Mi Perfil">
    <Grid RowDefinitions=".3*,.7*">

        <Grid Grid.Row="0" RowDefinitions="*,*" RowSpacing="0">
            <Image Aspect="AspectFill" Source="logofondo.png" Grid.RowSpan="2"/>
            <Grid BackgroundColor="ForestGreen" Opacity=".9" Grid.RowSpan="2"/>

            <Grid Grid.Row="0" ColumnDefinitions="*,*">
                <Image Grid.ColumnSpan="2"
                       Aspect="AspectFit"
                       HeightRequest="120"
                       Source="logouts.png"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </Grid>

            <Label Grid.Row="1"
                   Text="Mi Perfil"
                   FontSize="Large"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center"
                   Margin="0,0,0,10"/>
        </Grid>

        <Grid Grid.Row="1">
            <RoundRectangle Margin="0,-30,0,0"
                            CornerRadius="30,30,0,0"
                            Fill="White"/>

            <ScrollView>
                <VerticalStackLayout Margin="30,30,30,30" Spacing="20">

                    <!-- InformaciÃ³n del Usuario -->
                    <Frame BackgroundColor="#E8F5E9" 
                           CornerRadius="15" 
                           Padding="20"
                           HasShadow="False">
                        <VerticalStackLayout Spacing="15">
                            <Label Text="InformaciÃ³n Personal" 
                                   FontAttributes="Bold" 
                                   FontSize="Medium"
                                   TextColor="ForestGreen"/>

                            <Grid ColumnDefinitions="Auto,*" RowSpacing="10">
                                <Image Grid.Row="0" 
                                       Source="person.png" 
                                       WidthRequest="30" 
                                       HeightRequest="30"
                                       Margin="0,0,10,0"/>
                                <Label Grid.Row="0" Grid.Column="1" 
                                       Text="{Binding Nombre}" 
                                       FontSize="Medium"
                                       VerticalOptions="Center"/>

                                <Image Grid.Row="1" 
                                       Source="email.png" 
                                       WidthRequest="30" 
                                       HeightRequest="30"
                                       Margin="0,0,10,0"/>
                                <Label Grid.Row="1" Grid.Column="1" 
                                       Text="{Binding Correo}" 
                                       FontSize="Medium"
                                       VerticalOptions="Center"/>
                            </Grid>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Historial de Citas -->
                    <Label Text="Historial de Citas" 
                           FontAttributes="Bold" 
                           FontSize="Medium"
                           TextColor="#2D2D2D"
                           Margin="0,10,0,0"/>

                    <!-- Mensaje si no hay citas -->
                    <Frame IsVisible="{Binding TieneCitas, Converter={StaticResource InvertedBoolConverter}}"
                           BackgroundColor="#FFF3CD"
                           CornerRadius="10"
                           Padding="15"
                           HasShadow="False">
                        <Label Text="No tienes citas programadas. Â¡Agenda tu primera cita!"
                               TextColor="#856404"
                               HorizontalTextAlignment="Center"/>
                    </Frame>

                    <!-- Lista de Citas (SIN botÃ³n cancelar) -->
                    <CollectionView ItemsSource="{Binding Citas}"
                                    IsVisible="{Binding TieneCitas}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="White" 
                                       BorderColor="#E0E0E0"
                                       CornerRadius="10" 
                                       Padding="15"
                                       Margin="0,5"
                                       HasShadow="True">

                                    <VerticalStackLayout Spacing="8">
                                        <Label Text="{Binding Servicio}" 
                                               FontAttributes="Bold"
                                               FontSize="Medium"
                                               TextColor="ForestGreen"/>

                                        <Label TextColor="#666">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="ðŸ“… " FontSize="14"/>
                                                    <Span Text="{Binding Fecha, StringFormat='{0:dd/MM/yyyy}'}" 
                                                          FontSize="14"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <Label TextColor="#666">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="ðŸ• " FontSize="14"/>
                                                    <Span Text="{Binding Hora, StringFormat='{0:HH:mm}'}" 
                                                          FontSize="14"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <Label Text="{Binding Estado}" 
                                               FontSize="12"
                                               TextColor="Orange"
                                               FontAttributes="Italic"/>
                                    </VerticalStackLayout>

                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Nota informativa -->
                    <Frame BackgroundColor="#E3F2FD"
                           CornerRadius="10"
                           Padding="15"
                           HasShadow="False"
                           IsVisible="{Binding TieneCitas}"
                           Margin="0,10,0,0">
                        <Label TextColor="#1976D2"
                               FontSize="12"
                               HorizontalTextAlignment="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="ðŸ’¡ " FontSize="14"/>
                                    <Span Text="Para modificar o cancelar una cita, ve a " FontSize="12"/>
                                    <Span Text="'Modificar Cita'" FontSize="12" FontAttributes="Bold"/>
                                    <Span Text=" en el menÃº principal" FontSize="12"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </Frame>

                </VerticalStackLayout>
            </ScrollView>
        </Grid>
    </Grid>
</ContentPage>